import os
from openai import OpenAI

# --- –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø ---
# –¢—É—Ç DeepSeek-R1 (–∞–±–æ Llama 3.3) –ø–æ–∫–∞–∂–µ —Å–µ–±–µ –Ω–∞–π–∫—Ä–∞—â–µ, –±–æ —Ü–µ —á–∏—Å—Ç–∞ –∞–Ω–∞–ª—ñ—Ç–∏–∫–∞
CLIENT = OpenAI(base_url="http://localhost:11434/v1", api_key="lm-studio")
MODEL_NAME = "deepseek-r1:70b" 

OUTPUT_FILE = "SAFECUT_LAUNCH_BIBLE.md"

def read_file(filename):
    if os.path.exists(filename):
        with open(filename, 'r', encoding='utf-8') as f:
            return f.read()
    return f"[–î–∞–Ω—ñ –≤—ñ–¥—Å—É—Ç–Ω—ñ: {filename}]"

def run_simulation():
    # 1. –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ —á–∏—Å—Ç—ñ –¥–∞–Ω—ñ (–±–µ–∑ –∫–æ–¥—É!)
    market_data = read_file("rivne_market_data.md")
    tech_facts = read_file("1_technical_report.md") # –¢—É—Ç —Ü—ñ–Ω–∏ 500/100
    tech_flow = read_file("1_technical_flow.md")    # –¢—É—Ç –ª–æ–≥—ñ–∫–∞

    print(f"üöÄ –ó–∞–ø—É—Å–∫–∞—é –°—Ç—Ä–∞—Ç–µ–≥–∞ ({MODEL_NAME})...")
    print("   –í—Ö—ñ–¥–Ω—ñ –¥–∞–Ω—ñ —á–∏—Å—Ç—ñ. –†–∏–∑–∏–∫ –≥–∞–ª—é—Ü–∏–Ω–∞—Ü—ñ–π –º—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–π.")

    # 2. –ü—Ä–æ–º–ø—Ç –¥–ª—è CFO (–§—ñ–Ω–∞–Ω—Å–æ–≤–æ–≥–æ –î–∏—Ä–µ–∫—Ç–æ—Ä–∞)
    system_prompt = """
    –¢–ò ‚Äî CFO (–§–Ü–ù–ê–ù–°–û–í–ò–ô –î–ò–†–ï–ö–¢–û–†) –ü–†–û–ï–ö–¢–£ SAFECUT.

    –¢–í–û–Ø –ú–ï–¢–ê: –°—Ç–≤–æ—Ä–∏—Ç–∏ —Ñ—ñ–Ω–∞–ª—å–Ω–∏–π –¥–æ–∫—É–º–µ–Ω—Ç "SAFECUT_LAUNCH_BIBLE.md".

    –í–•–Ü–î–ù–Ü –î–ê–ù–Ü (–ñ–û–†–°–¢–ö–Ü –§–ê–ö–¢–ò, –ù–ï –í–ò–ì–ê–î–£–ô):
    1. –ü—Ä–æ–¥—É–∫—Ç: –ì—ñ–ø–µ—Ä-–ª–æ–∫–∞–ª—å–Ω–∏–π —Å–µ—Ä–≤—ñ—Å –≤–∏–∫–ª–∏–∫—É –±–∞—Ä–±–µ—Ä–∞ (Uber-style).
    2. –õ–æ–≥—ñ—Å—Ç–∏–∫–∞: –ë–∞—Ä–±–µ—Ä –æ–±—Å–ª—É–≥–æ–≤—É—î –¢–Ü–õ–¨–ö–ò —Å–≤—ñ–π —Ä–∞–π–æ–Ω (–ø—ñ—à–∫–∏ 10-15 —Ö–≤). –í–∏—Ç—Ä–∞—Ç–∏ –Ω–∞ –¥–æ—Ä–æ–≥—É = 0 –≥—Ä–Ω.
    3. –¶—ñ–Ω–∏ (Hardcoded):
    - –°—Ç—Ä–∏–∂–∫–∞: 500 –≥—Ä–Ω (–ë–∞–∑–∞).
    - –ë–æ—Ä–æ–¥–∞: 100 –≥—Ä–Ω (–¢—ñ–ª—å–∫–∏ —è–∫ –æ–ø—Ü—ñ—è –¥–æ —Å—Ç—Ä–∏–∂–∫–∏).
    - –ë–∞—Ç—å–∫–æ+–°–∏–Ω: 300 –≥—Ä–Ω (–¢—ñ–ª—å–∫–∏ —è–∫ –æ–ø—Ü—ñ—è, —Ç–æ–±—Ç–æ —á–µ–∫ 500+300=800).
    4. –ë–µ–Ω—á–º–∞—Ä–∫ –†–∏–Ω–æ–∫ (–†—ñ–≤–Ω–µ):
    - –£ —Å–∞–ª–æ–Ω—ñ –±–∞—Ä–±–µ—Ä –æ—Ç—Ä–∏–º—É—î 35-40% –≤—ñ–¥ —á–µ–∫—É (max 200 –≥—Ä–Ω –∑ —Å—Ç—Ä–∏–∂–∫–∏).

    –ó–ê–í–î–ê–ù–ù–Ø:
    –ù–∞–ø–∏—à–∏ —Å—Ç—Ä–∞—Ç–µ–≥—ñ—é, –±–∞–∑—É—é—á–∏—Å—å –Ω–∞ —Å—Ü–µ–Ω–∞—Ä—ñ—ó "–ö–æ–º—ñ—Å—ñ—è 30%".

    –°–¢–†–£–ö–¢–£–†–ê –ó–í–Ü–¢–£:
    1. **Unit Economics (The 30% Strategy)**:
    - –ü–æ–∫–∞–∂–∏ —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –¥–ª—è —á–µ–∫—É 500 –≥—Ä–Ω (–°—Ç—Ä–∏–∂–∫–∞).
    - –ü–æ–∫–∞–∂–∏ —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –¥–ª—è —á–µ–∫—É 600 –≥—Ä–Ω (–°—Ç—Ä–∏–∂–∫–∞ + –ë–æ—Ä–æ–¥–∞).
    - –î–æ–≤–µ–¥–∏ —Ü–∏—Ñ—Ä–∞–º–∏, —á–æ–º—É –±–∞—Ä–±–µ—Ä—É –≤–∏–≥—ñ–¥–Ω—ñ—à–µ –≤—ñ–¥–¥–∞—Ç–∏ 30% –Ω–∞–º, –Ω—ñ–∂ 60% —Å–∞–ª–æ–Ω—É.
   
    2. **Technical Constraints (–¢–µ—Ö–Ω—ñ—á–Ω–µ –¢–ó –¥–ª—è —Ä–æ–∑—Ä–æ–±–Ω–∏–∫—ñ–≤)**:
    - –°—Ñ–æ—Ä–º—É–ª—é–π –ø—Ä–∞–≤–∏–ª–æ –¥–ª—è –∫–æ–¥—É: "–ü–æ—Å–ª—É–≥–∏ 'beard' —Ç–∞ 'family' –ù–ï –ú–û–ñ–£–¢–¨ –±—É—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω—ñ –æ–∫—Ä–µ–º–æ". –í–æ–Ω–∏ –¥–æ—Å—Ç—É–ø–Ω—ñ (unlocked) —Ç—ñ–ª—å–∫–∏ –∫–æ–ª–∏ –æ–±—Ä–∞–Ω–∞ "haircut".
    - –°—Ñ–æ—Ä–º—É–ª—é–π –ø—Ä–∞–≤–∏–ª–æ –¥–ª—è 'DistrictSelector': "–ë–∞—Ä–±–µ—Ä –±–∞—á–∏—Ç—å —Ç—ñ–ª—å–∫–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –∑—ñ —Å–≤–æ–≥–æ —Ä–∞–π–æ–Ω—É".
   
    3. **Retention Strategy (–õ–æ—è–ª—å–Ω—ñ—Å—Ç—å)**:
    - –û–ø–∏—à–∏ –º–µ—Ö–∞–Ω—ñ–∫—É "10-—Ç–∞ —Å—Ç—Ä–∏–∂–∫–∞". –û—Å–∫—ñ–ª—å–∫–∏ –∫–æ–º—ñ—Å—ñ—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∏ –≤–∏—Å–æ–∫–∞ (30%), –º–∏ (–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞) –ø–æ–∫—Ä–∏–≤–∞—î–º–æ –≤–∞—Ä—Ç—ñ—Å—Ç—å 10-—ó —Å—Ç—Ä–∏–∂–∫–∏ (–∞–±–æ –¥—ñ–ª–∏–º–æ –≤–∏—Ç—Ä–∞—Ç–∏ –∑ –±–∞—Ä–±–µ—Ä–æ–º 50/50), —â–æ–± —É—Ç—Ä–∏–º–∞—Ç–∏ –∫–ª—ñ—î–Ω—Ç–∞ –≤ –µ–∫–æ—Å–∏—Å—Ç–µ–º—ñ.

    4. **Final Verdict**:
    - –ó–∞—Ç–≤–µ—Ä–¥–∏—Ç–∏ –∫–æ–º—ñ—Å—ñ—é: 30%.
    - –ó–∞—Ç–≤–µ—Ä–¥–∏—Ç–∏ —Ü—ñ–Ω–∏: 500 / 100 / 300.
    - –î–∞—Ç–∏ –∫–æ–º–∞–Ω–¥—É "GO" –Ω–∞ –∑–º—ñ–Ω—É –∫–æ–¥—É.

    –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π —Ç—ñ–ª—å–∫–∏ —Ü—ñ –¥–∞–Ω—ñ. –ñ–æ–¥–Ω–∏—Ö —Ç–∞–∫—Å—ñ, –∂–æ–¥–Ω–∏—Ö –ø–æ–¥–∞—Ç–∫—ñ–≤, –∂–æ–¥–Ω–∏—Ö –≤–∏–≥–∞–¥–∞–Ω–∏—Ö —Ñ–∞–π–ª—ñ–≤.
    """

    user_message = f"""
    –û–°–¨ –î–ê–ù–Ü –ü–†–û –†–ò–ù–û–ö:
    {market_data}
    
    –û–°–¨ –ù–ê–®–Ü –¢–ï–•–ù–Ü–ß–ù–Ü –§–ê–ö–¢–ò:
    {tech_facts}
    
    –û–°–¨ –õ–û–ì–Ü–ö–ê –†–û–ë–û–¢–ò:
    {tech_flow}
    """

    try:
        response = CLIENT.chat.completions.create(
            model=MODEL_NAME,
            messages=[
                {"role": "system", "content": system_prompt},
                {"role": "user", "content": user_message}
            ],
            temperature=0.7 # –î–ª—è DeepSeek R1 –ø–æ—Ç—Ä—ñ–±–Ω–∞ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞, —â–æ–± –≤—ñ–Ω "–ø–æ–¥—É–º–∞–≤"
        )
        
        # –í–∏—Ä—ñ–∑–∞—î–º–æ <think> –±–ª–æ–∫–∏, —â–æ–± –∑–≤—ñ—Ç –±—É–≤ —á–∏—Å—Ç–∏–º
        content = response.choices[0].message.content.replace("<think>", "")

        with open(OUTPUT_FILE, "w", encoding="utf-8") as f:
            f.write(content)
            
        print(f"‚úÖ –ë–Ü–ë–õ–Ü–Ø –ì–û–¢–û–í–ê: {OUTPUT_FILE}")
        print("   –ü—Ä–æ—á–∏—Ç–∞–π —Ü–µ–π —Ñ–∞–π–ª. –¶–µ –º–∞—î –±—É—Ç–∏ —è–∫—ñ—Å–Ω–∞ –∞–Ω–∞–ª—ñ—Ç–∏–∫–∞.")

    except Exception as e:
        print(f"üî• –ü–æ–º–∏–ª–∫–∞: {e}")

if __name__ == "__main__":
    run_simulation()